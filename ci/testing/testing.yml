---
platform: linux

image_resource:
  type: docker-image
  source: {repository: "mumoshu/dcind", tag: "latest"}


inputs:
- name: source-repos
- name: mysql-image
- name: alpine-golang-bash


run:
  path: sh
  args:
    - -c
    - |
      source /docker-lib.sh  2>/dev/null
      start_docker
      docker-compose version
      docker load -q --input ./mysql-image/image
      docker load -q --input ./alpine-golang-bash/image
      docker images
      cd ./source-repos/
      docker-compose -f ./ci/testing/docker-compose.yml run app
      TEST_RESULTS=$?
      exit ${TEST_RESULTS}
